---
phase: 02-progress-indicators
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - ScreenSort/Views/ProcessingView.swift
autonomous: false

must_haves:
  truths:
    - "User sees 'X of Y screenshots' count during processing"
    - "Progress indicator updates smoothly without UI stutter"
    - "User receives haptic feedback when processing completes"
    - "Haptic does NOT fire when user cancels processing"
  artifacts:
    - path: "ScreenSort/Views/ProcessingView.swift"
      provides: "Determinate ProgressView and completion haptic"
      contains: "ProgressView(value:"
      contains_also: ".sensoryFeedback(.success"
  key_links:
    - from: "ProgressView"
      to: "viewModel.processingProgress"
      via: "value binding"
      pattern: "ProgressView.*value.*processingProgress"
    - from: "sensoryFeedback"
      to: "viewModel.isProcessing"
      via: "trigger with condition"
      pattern: "sensoryFeedback.*success.*trigger.*isProcessing"
---

<objective>
Add determinate progress indicator and completion haptic feedback to ProcessingView.

Purpose: Users need clear feedback on processing progress (accessibility via native ProgressView) and tactile confirmation when processing completes successfully.

Output: ProcessingView.swift with native ProgressView for accessibility and completion haptic that fires only on successful completion (not cancellation).
</objective>

<execution_context>
@/Users/mit/.claude/get-shit-done/workflows/execute-plan.md
@/Users/mit/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/02-progress-indicators/02-RESEARCH.md
@ScreenSort/Views/ProcessingView.swift
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add native ProgressView with accessibility support</name>
  <files>ScreenSort/Views/ProcessingView.swift</files>
  <action>
In the `processingSection` computed property, add a native SwiftUI `ProgressView(value:total:)` below the existing custom Capsule progress bar (around line 285-286, after the GeometryReader block).

Add this code after the existing progress bar and before the "X of Y screenshots" text:

```swift
// Native ProgressView for accessibility (VoiceOver announces progress)
ProgressView(
    value: Double(viewModel.processingProgress.current),
    total: Double(max(viewModel.processingProgress.total, 1))
)
.progressViewStyle(.linear)
.tint(Color(hex: "6366F1"))
.accessibilityLabel("Processing progress")
.accessibilityValue("\(viewModel.processingProgress.current) of \(viewModel.processingProgress.total) screenshots")
```

The existing custom Capsule bar provides visual flair with gradient. The native ProgressView adds accessibility support (VoiceOver announces progress automatically).

Do NOT remove the existing custom progress bar - keep both.
  </action>
  <verify>
Build the project with Cmd+B in Xcode (or `xcodebuild -scheme ScreenSort build` from CLI).
No compiler errors or warnings related to ProgressView.
  </verify>
  <done>
ProcessingView shows both the custom gradient Capsule progress bar AND a native linear ProgressView during processing.
  </done>
</task>

<task type="auto">
  <name>Task 2: Add completion haptic with success condition</name>
  <files>ScreenSort/Views/ProcessingView.swift</files>
  <action>
In the `body` computed property, add a `.sensoryFeedback` modifier to the NavigationStack (around line 81, after the existing `.animation` modifiers).

Add this modifier:

```swift
.sensoryFeedback(.success, trigger: viewModel.isProcessing) { oldValue, newValue in
    // Fire only when processing completes successfully (true -> false) with results
    // Do NOT fire on cancellation (which would have empty results)
    oldValue == true && newValue == false && !viewModel.results.isEmpty
}
```

This ensures:
- Haptic fires when `isProcessing` goes from true to false
- Haptic does NOT fire if results are empty (i.e., user cancelled)
- Uses `.success` feedback type (distinct from the existing `.impact` on the button at line 226)

Note: Line 226 already has `.sensoryFeedback(.impact(flexibility: .soft), trigger: viewModel.isProcessing)` on the Process button. This new modifier is different - it's for completion notification, not button press feedback.
  </action>
  <verify>
Build the project with Cmd+B in Xcode (or `xcodebuild -scheme ScreenSort build` from CLI).
No compiler errors or warnings related to sensoryFeedback.
  </verify>
  <done>
ProcessingView has completion haptic that triggers on successful processing completion.
  </done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>
    Determinate progress indicator with native ProgressView and completion haptic feedback.
  </what-built>
  <how-to-verify>
    1. Launch the app on a physical iOS device (haptics don't work in Simulator)
    2. Grant photo library and Google account permissions
    3. Tap "Process Screenshots" to start processing
    4. Verify DURING processing:
       - You see the animated ProgressRing (circular) with count inside
       - You see the custom gradient Capsule progress bar
       - You see the native linear ProgressView below it
       - You see "X of Y screenshots" text
       - Progress updates smoothly without stutter
    5. Let processing complete naturally
    6. Verify ON COMPLETION:
       - You feel a success haptic (gentle tap)
       - Results appear in the list
    7. Process again but tap CANCEL before completion
    8. Verify ON CANCELLATION:
       - You do NOT feel a haptic (no feedback)
       - Processing stops and no results appear
    9. (Optional) Enable VoiceOver and verify it announces progress
  </how-to-verify>
  <resume-signal>Type "approved" if all verifications pass, or describe any issues</resume-signal>
</task>

</tasks>

<verification>
1. Build succeeds without errors or warnings
2. ProgressView visible during processing
3. Completion haptic fires only on successful completion
4. Haptic does NOT fire on cancellation
5. UI remains responsive during processing (no stutter)
</verification>

<success_criteria>
- User sees "X of Y screenshots" count during processing (existing, confirmed working)
- Progress indicator updates smoothly without UI stutter
- Native ProgressView provides accessibility support
- User receives haptic feedback when processing completes successfully
- No haptic on cancellation
</success_criteria>

<output>
After completion, create `.planning/phases/02-progress-indicators/02-01-SUMMARY.md`
</output>
